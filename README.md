Instructions for running this analysis suite.

This code is designed to process and analyze files that have been generated by Suite2P following imaging of GCaMP signals. The general workflow looks something like this:

1) Image responses of GCaMP-expressing cells to various visual stimuli.
2) Convert the raw scanbox files to hdf5 files.
3) Run Suite2P on all the hdf5 files from an imaging session to generate fluorescence traces for each roi across all experiments. This way, responses from each roi/cell to all visual stimuli and under all conditions (i.e. control vs CNO) can be analyzed.
4) Process the mat file generated by Suite2P by running Suite2P_Analysis_Batch.m. This code creates data structures for all rois that are split according to the different experiments (i.e. different visual stimuli presented and/or imaging conditions).
5) Compile tuning properties for all rois from specific subsets of experiments by running Tuning_Analysis.m on the data structures generated in step 4. This code creates data structures containing preferred SF and TF as well as DSI, OSI, and preferred direction for each roi/cell. It is necessary to compile multiple experiments when doing this analysis because the full range of parameters tested are often collected over multiple experiments.
6) Compare rois/cells in control versus CNO by running Control_CNO_Compare_Compile.m.

Suite2P_Analysis_Batch.m

This code expects several different types of files with a specific directory structure. The files are as follows:
 1) A mat file containing fluorescence traces for all rois in a directory named: Suite2P
 2) Mat files generated by scanbox from each experiment in a directory named: Scanbox_Files
 3) Analyzer files for each experiment in a directory named: Analyzer_Files
 4) Text files generated by Spike2 for each experiment in a directory named: Spike2_Files

The code expects the directories containing these files to be located in the following directory structure:

Experiment_Name/Recording_Day/

For example, the scanbox files would be located at:

Experiment_Name/Recording_Day/Scanbox_Files/



Variable Names:

In the Matlab file you specify the location of the files by providing the names of the directories where to they are located using the following variables:
1) experiment_name (typically the mouse ID number; eg. 6627)
2) recording_day (eg. day1, day2, day3, etc.)

There are three 'flags' representing analysis steps you can 'turn on' by setting to a value of 1. These are:
1) analyze_all_files - when set to 1, the code will use every mat file in the Scanbox_Files directory and analyze the relevant part of the fluorescence traces.
2) smoothTraces - when set to 1, this will smooth the fluoresence traces
3) subtractNeuropil - when set to 1, this will subtract the neuropil signal from the fluorescence traces
4) photoBleachSubtract - when set to 1, this will use the interleaved blank trials to fit the background fluorescnce decay with a polynomial and subtract from the fluorescence traces to try to linearize the dfof trace.

Output:

The code saves data structures in mat files for each experiment/file used from the Scanbox_Files directory in the following location:

Experiment_Name/Recording_Day/Analysis

They are named after the scanbox file that was used to generate them. A typical scanbox name is: day1_000_000.mat. The corresponding mat file in the Analysis directory would be named: day1_000_000_Data.mat
